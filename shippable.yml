#
machine:


#http://docs.shippable.com/integrations/imageRegistries/ecr/
integrations:
  hub:
    - integrationName: ecr-integration
      type: ecr
      region: us-east-1
      agent_only: true
      # branches:
      #   only:
      #     - master



build:

  pre_ci:
  # Used primarily if you need to use a custom image for your build or if you need to customize behavior of the default CI container.
##pull first?
    # - docker images
    - docker pull 085114940579.dkr.ecr.us-east-1.amazonaws.com/devexi:dsr-test-img
    - cat $JOB_STATE/my_image.env
    - ls -laR
    - echo "versionName=$BRANCH.$BUILD_NUMBER" >> $JOB_STATE/my_image.env
    - cat $JOB_STATE/my_image.env
    - docker build -t 085114940579.dkr.ecr.us-east-1.amazonaws.com/devexi:dsr-test-img .
    - docker push 085114940579.dkr.ecr.us-east-1.amazonaws.com/devexi:dsr-test-img
    # - docker images

  pre_ci_boot:
  # Used to override the default image used for CI with your own custom image. You can also set specific options for booting up the default CI container.
  #   image_name: aws-account-id.dkr.ecr.us-east-1.amazonaws.com/image-name
  #   image_tag: tip
  #   pull: true
  #   options: "-e HOME=/root"
    image_name: 085114940579.dkr.ecr.us-east-1.amazonaws.com/devexi
    image_tag: dsr-test-img
    pull: true
###on INTEGRATIONs not here.
    # agent_only: true
## no awscli, we dont do docker inside docker
#https://github.com/Shippable/support/issues/2945
#http://docs.shippable.com/tutorials/ci/hub-amazon-ecr-custom-ci-image/
      # - docker images
      # - ls -laR
      # - cat $JOB_STATE/my_image.env


  ci:
    - ls -laR
    - echo "yello"
    # - echo "versionName=$BRANCH.$BUILD_NUMBER" >> $JOB_STATE/my_image.env
    - cat $JOB_STATE/my_image.env


#http://docs.shippable.com/tutorials/ci/hub-amazon-ecr-push-docker-image/
  post_ci:
    - ls -laR
    - cat $JOB_STATE/my_image.env
    # - docker push 085114940579.dkr.ecr.us-east-1.amazonaws.com/devexi:dsr-test-img
